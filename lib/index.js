var t=void 0,e=require("chalk"),n=require("istanbul"),r=require("path"),o=require("puppeteer"),i=require("lodash"),u=require("./coverage-parser"),c=u.getBranchCoverage,a=u.getFunctionCoverage,s=u.getStatementCoverage,d=function(t,e){return t?e:{}},f={timeout:1e4,formats:[],output:process.cwd(),verbose:!1},h=function(u,h){void 0===h&&(h={});var l=h.coverage;void 0===l&&(l={output:f.output,formats:f.formats});var m=h.verbose;void 0===m&&(m=f.verbose);var v=h.timeout;void 0===v&&(v=f.timeout);var p="file:///"+r.join(r.isAbsolute(u)?"":process.cwd(),u).replace(/\\/g,"/"),g=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];m&&console.log.apply(console,t)};return new Promise(function(r,u){new Promise(function(t,h){var b,y,w,x;return b=setTimeout(function(){g(),g(e.red("Timeout exceeded.")),g(),u(new Error("Timeout exceeded"))},v||f.timeout),g("Testing",e.magenta(p)),o.launch().then(function(o){try{return(y=o).newPage().then(function(o){var v=this;try{return w=o,x=[],w.exposeFunction("logAssertion",function(t){return new Promise(function(e,n){return t.result||t.todo||x.push(t),e()}.bind(v))}).then(function(o){var v=this;try{return w.exposeFunction("report",function(t){return new Promise(function(o,u){function h(){return g(),j=i.forIn(i.groupBy(x,function(t){return t.module}),function(t,e,n){n[e]=i.groupBy(t,function(t){return t.name})}),i.forIn(j,function(t,n){var r=!!n;r&&g(n),i.forIn(t,function(t,n){var o=r?"  ":"";g(o+n),t.forEach(function(t){var n=t.message,r=t.expected,u=t.actual;g(e.red(o+"  âœ— "+(n?""+e.gray(n):"Test failure"))),i.isUndefined(u)||g(o+"      expected: "+r+", actual: "+u)}),g()})}),g(e.blue("Took "+t.runtime+"ms to run "+t.total+" tests. "+t.passed+" passed, "+t.failed+" failed.")),y.close().then(function(e){try{return clearTimeout(b),r(Object.assign({},{pass:!t.failed,results:i.omit(Object.assign({},t),"runtime")},d(l,{coverage:q}))),o()}catch(t){return u(t)}}.bind(this),u)}var v,p,U,T,j,q;return q={},l?w.evaluate(function(){return __coverage__}).then(function(t){try{return v=t,p=new n.Collector,U=new n.Reporter(!1,l.output||f.output),T=l.formats||f.formats,m&&!T.includes("text-summary")&&T.push("text-summary"),q=Object.assign({},q,{branch:c(v),function:a(v),statement:s(v)}),p.add(v),U.addAll(T),U.write(p,!0,function(){T.includes("text-summary")&&1===T.length||(g(),g("Coverage written to "+e.magenta(l.output)))}),h.call(this)}catch(t){return u(t)}}.bind(this),u):h.call(this)}.bind(v))}).then(function(n){var r=this;try{w.on("load",function(){return new Promise(function(t,n){return w.evaluate(function(){return"undefined"==typeof QUnit||!QUnit}).then(function(r){try{return r&&(g(),g(e.red("Unable to find the QUnit object.")),g(),u(new Error("Unable to find the QUnit object"))),w.evaluate(function(){QUnit.done(window.report),QUnit.log(window.logAssertion)}).then(function(e){try{return t()}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)}.bind(r))});var o=function(){try{return t()}catch(t){return h(t)}}.bind(this),i=function(t){try{return u(new Error("Failed to open the test file.")),o()}catch(t){return h(t)}}.bind(this);try{return w.goto(p).then(function(t){try{return o()}catch(t){return i(t)}}.bind(this),i)}catch(t){i(t)}}catch(t){return h(t)}}.bind(this),h)}catch(t){return h(t)}}.bind(this),h)}catch(t){return h(t)}}.bind(this),h)}catch(t){return h(t)}}.bind(this),h)}.bind(t))})};module.exports=h;
//# sourceMappingURL=index.js.map
