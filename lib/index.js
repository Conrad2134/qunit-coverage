var t=void 0,e=require("chalk"),n=require("istanbul"),r=require("path"),i=require("puppeteer"),o=require("lodash"),u=require("./coverage-parser"),c=u.getBranchCoverage,a=u.getFunctionCoverage,s=u.getStatementCoverage,h=function(t,e){return t?e:{}},d={timeout:1e4,formats:[],output:process.cwd(),verbose:!1},f=function(u,f){void 0===f&&(f={});var l=f.coverage;void 0===l&&(l={output:d.output,formats:d.formats});var m=f.verbose;void 0===m&&(m=d.verbose);var b=f.timeout;void 0===b&&(b=d.timeout);var v="file:///"+r.join(r.isAbsolute(u)?"":process.cwd(),u).replace(/\\/g,"/"),p=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];m&&console.log.apply(console,t)};return new Promise(function(r,u){new Promise(function(t,f){var g,y,w,x,U,P=this;return g=function(t,n){return new Promise(function(r,i){var o=function(){try{return n&&u(n),r()}catch(t){return i(t)}}.bind(this),c=function(t){try{return p(),p(e.yellow("Failed to close Chromium.")),p(),o()}catch(t){return i(t)}}.bind(this);try{return t.close().then(function(t){try{return o()}catch(t){return c(t)}}.bind(this),c)}catch(t){c(t)}}.bind(P))},p("Testing",e.magenta(v)),i.launch().then(function(i){try{return(y=i).newPage().then(function(i){var u=this;try{return w=i,x=[],U=setTimeout(function(){p(),p(e.red("Timeout exceeded.")),p(),g(y,new Error("Timeout exceeded"))},b||d.timeout),w.exposeFunction("logAssertion",function(t){return new Promise(function(e,n){return t.result||t.todo||x.push(t),e()}.bind(u))}).then(function(i){var u=this;try{return w.exposeFunction("report",function(t){return new Promise(function(i,u){function f(){return p(),T=o.forIn(o.groupBy(x,function(t){return t.module}),function(t,e,n){n[e]=o.groupBy(t,function(t){return t.name})}),o.forIn(T,function(t,n){var r=!!n;r&&p(n),o.forIn(t,function(t,n){var i=r?"  ":"";p(i+n),t.forEach(function(t){var n=t.message,r=t.expected,u=t.actual;p(e.red(i+"  âœ— "+(n?""+e.gray(n):"Test failure"))),o.isUndefined(u)||p(i+"      expected: "+r+", actual: "+u)}),p()})}),p(e.blue("Took "+t.runtime+"ms to run "+t.total+" tests. "+t.passed+" passed, "+t.failed+" failed.")),g(y).then(function(e){try{return clearTimeout(U),r(Object.assign({},{pass:!t.failed,results:o.omit(Object.assign({},t),"runtime")},h(l,{coverage:j}))),i()}catch(t){return u(t)}}.bind(this),u)}var b,v,P,Q,T,j;return j={},l?w.evaluate(function(){return __coverage__}).then(function(t){try{return b=t,v=new n.Collector,P=new n.Reporter(!1,l.output||d.output),Q=l.formats||d.formats,m&&!Q.includes("text-summary")&&Q.push("text-summary"),j=Object.assign({},j,{branch:c(b),function:a(b),statement:s(b)}),v.add(b),P.addAll(Q),P.write(v,!0,function(){Q.includes("text-summary")&&1===Q.length||(p(),p("Coverage written to "+e.magenta(l.output)))}),f.call(this)}catch(t){return u(t)}}.bind(this),u):f.call(this)}.bind(u))}).then(function(n){var r=this;try{w.on("load",function(){return new Promise(function(t,n){return w.evaluate(function(){return"undefined"==typeof QUnit||!QUnit}).then(function(r){function i(){return w.evaluate(function(){QUnit.done(window.report),QUnit.log(window.logAssertion),QUnit.start()}).then(function(e){try{return t()}catch(t){return n(t)}}.bind(this),n)}try{return r?(p(),p(e.red("Unable to find the QUnit object.")),p(),g(y,new Error("Unable to find the QUnit object")).then(function(t){try{return i.call(this)}catch(t){return n(t)}}.bind(this),n)):i.call(this)}catch(t){return n(t)}}.bind(this),n)}.bind(r))});var i=function(){try{return t()}catch(t){return f(t)}}.bind(this),o=function(t){try{return p(),p(e.red("Failed to open the test file.")),p(),g(y,new Error("Failed to open the test file.")).then(function(t){try{return i()}catch(t){return f(t)}}.bind(this),f)}catch(t){return f(t)}}.bind(this);try{return w.goto(v).then(function(t){try{return i()}catch(t){return o(t)}}.bind(this),o)}catch(t){o(t)}}catch(t){return f(t)}}.bind(this),f)}catch(t){return f(t)}}.bind(this),f)}catch(t){return f(t)}}.bind(this),f)}catch(t){return f(t)}}.bind(this),f)}.bind(t))})};module.exports=f;
//# sourceMappingURL=index.js.map
