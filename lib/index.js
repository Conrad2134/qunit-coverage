var t=void 0,e=require("chalk"),n=require("istanbul"),r=require("path"),o=require("puppeteer"),i=require("lodash"),u=require("./coverage-parser"),c=u.getBranchCoverage,a=u.getFunctionCoverage,s=u.getStatementCoverage,d=function(t,e){return t?e:{}},f={timeout:1e4,formats:[],output:process.cwd(),verbose:!1},h=function(u,h){void 0===h&&(h={});var l=h.coverage;void 0===l&&(l={output:f.output,formats:f.formats});var m=h.verbose;void 0===m&&(m=f.verbose);var v=h.timeout;void 0===v&&(v=f.timeout);var p="file:///"+r.join(r.isAbsolute(u)?"":process.cwd(),u).replace(/\\/g,"/"),b=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];m&&console.log.apply(console,t)};return new Promise(function(r,u){new Promise(function(t,h){var g,y,w,x;return g=setTimeout(function(){b(),b(e.red("Timeout exceeded.")),b(),u(new Error("Timeout exceeded"))},v||f.timeout),b("Testing",e.magenta(p)),o.launch().then(function(o){try{return(y=o).newPage().then(function(o){var v=this;try{return w=o,x=[],w.exposeFunction("logAssertion",function(t){return new Promise(function(e,n){return t.result||t.todo||x.push(t),e()}.bind(v))}).then(function(o){var v=this;try{return w.exposeFunction("report",function(t){return new Promise(function(o,u){function h(){b(),T=i.forIn(i.groupBy(x,function(t){return t.module}),function(t,e,n){n[e]=i.groupBy(t,function(t){return t.name})}),i.forIn(T,function(t,n){var r=!!n;r&&b(n),i.forIn(t,function(t,n){var o=r?"  ":"";b(o+n),t.forEach(function(t){var n=t.message,r=t.expected,u=t.actual;b(e.red(o+"  âœ— "+(n?""+e.gray(n):"Test failure"))),i.isUndefined(u)||b(o+"      expected: "+r+", actual: "+u)}),b()})}),b(e.blue("Took "+t.runtime+"ms to run "+t.total+" tests. "+t.passed+" passed, "+t.failed+" failed."));var n=function(){try{return clearTimeout(g),r(Object.assign({},{pass:!t.failed,results:i.omit(Object.assign({},t),"runtime")},d(l,{coverage:j}))),o()}catch(t){return u(t)}}.bind(this),c=function(t){try{return n()}catch(t){return u(t)}}.bind(this);try{return y.close().then(function(t){try{return n()}catch(t){return c(t)}}.bind(this),c)}catch(t){c(t)}}var v,p,U,Q,T,j;return j={},l?w.evaluate(function(){return __coverage__}).then(function(t){try{return v=t,p=new n.Collector,U=new n.Reporter(!1,l.output||f.output),Q=l.formats||f.formats,m&&!Q.includes("text-summary")&&Q.push("text-summary"),j=Object.assign({},j,{branch:c(v),function:a(v),statement:s(v)}),p.add(v),U.addAll(Q),U.write(p,!0,function(){Q.includes("text-summary")&&1===Q.length||(b(),b("Coverage written to "+e.magenta(l.output)))}),h.call(this)}catch(t){return u(t)}}.bind(this),u):h.call(this)}.bind(v))}).then(function(n){var r=this;try{w.on("load",function(){return new Promise(function(t,n){return w.evaluate(function(){return"undefined"==typeof QUnit||!QUnit}).then(function(r){try{return r&&(b(),b(e.red("Unable to find the QUnit object.")),b(),u(new Error("Unable to find the QUnit object"))),w.evaluate(function(){QUnit.done(window.report),QUnit.log(window.logAssertion),QUnit.start()}).then(function(e){try{return t()}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n)}.bind(r))});var o=function(){try{return t()}catch(t){return h(t)}}.bind(this),i=function(t){try{return u(new Error("Failed to open the test file.")),o()}catch(t){return h(t)}}.bind(this);try{return w.goto(p).then(function(t){try{return o()}catch(t){return i(t)}}.bind(this),i)}catch(t){i(t)}}catch(t){return h(t)}}.bind(this),h)}catch(t){return h(t)}}.bind(this),h)}catch(t){return h(t)}}.bind(this),h)}catch(t){return h(t)}}.bind(this),h)}.bind(t))})};module.exports=h;
//# sourceMappingURL=index.js.map
